I will implement persistent comment collapse state using secure, HTTP-only cookies as requested.

### 1. Create Server Action for Cookie Management
I will create a new file `apps/feed/src/lib/comments.actions.ts` to handle cookie operations securely on the server.
- **Function**: `updateCommentCollapseState(postId: string, commentId: string, isCollapsed: boolean)`
- **Logic**:
  - Read the existing `feedgot_c_col_${postId}` cookie using `next/headers`.
  - Parse the comma-separated list of collapsed IDs.
  - Add or remove the `commentId` based on `isCollapsed`.
  - Set the updated cookie with:
    - `HttpOnly: true` (Security)
    - `Secure: true` (Security)
    - `SameSite: Lax` (Security)
    - `Max-Age: 30 days` (Requirement)
    - `Path: /`

### 2. Update CommentThread Component
I will modify `apps/feed/src/components/comments/CommentThread.tsx` to use the server action instead of client-side cookie manipulation.
- **Remove**: Client-side `document.cookie` reading (useEffect) and writing (`setCookie`).
- **Update**: `toggleCollapse` function to call `updateCommentCollapseState`.
- **State**: Rely on `initialCollapsedIds` prop (passed from server) for initial state, and local React state for immediate UI updates.

### 3. Verify Server-Side Reading
I will verify `apps/feed/src/lib/comments.server.ts` to ensure `readInitialCollapsedCommentIds` correctly parses the CSV format generated by the new server action.
- The current implementation expects CSV, but the old client code was writing JSON. My changes will fix this mismatch, enabling proper server-side rendering of the collapsed state.

### 4. Cleanup
I will check if `apps/feed/src/lib/comments.ts` is still needed and remove unused client-side cookie helpers if appropriate.

This approach satisfies all requirements:
- **Persistence**: Cookies last 30 days.
- **Security**: HttpOnly and Secure flags prevent XSS access.
- **Consistency**: Server-side rendering ensures the UI matches the stored state on load/refresh.
- **Performance**: Uses a single cookie per post to avoid header bloat, while still effectively storing state per comment.
